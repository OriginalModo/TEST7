<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Продукты</title>
</head>
<body>
<h1>Добавить продукт</h1>
<form id="productForm">
    <input type="text" name="name" placeholder="Название" required>
    <textarea name="description" placeholder="Описание" required></textarea>
    <input type="number" name="price" placeholder="Цена" required min="0.01" step="0.01">
    <button type="submit">Отправить</button>
</form>

<h2>Список продуктов</h2>
<table id="productTable">
    <thead>
    <tr>
        <th>Название</th>
        <th>Описание</th>
        <th>Цена</th>
    </tr>
    </thead>
    <tbody>
    </tbody>
</table>

<script>
    const form = document.getElementById('productForm');
    const tableBody = document.getElementById('productTable').querySelector('tbody');

    form.addEventListener('submit', async (e) => {
        e.preventDefault();
        const formData = new FormData(form);
        const data = Object.fromEntries(formData);

        const response = await fetch('/api/products/create/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(data),
        });

        if (response.ok) {
            form.reset();
            loadProducts();
        } else {
            alert('Ошибка при добавлении продукта');
        }
    });

    async function loadProducts() {
        const response = await fetch('/api/products/');
        const products = await response.json();
        tableBody.innerHTML = '';

        products.forEach(product => {
            const row = `<tr>
                       <td>${product.name}</td>
                       <td>${product.description}</td>
                       <td>${product.price}</td>
                   </tr>`;
            tableBody.insertAdjacentHTML('beforeend', row);
        });
    }

    loadProducts();
</script>
</body>
</html>
